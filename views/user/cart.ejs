













<%-include('navbar') %>


<div class="container mt-5">
    <h2>Your Cart</h2>

    <!-- Check if there's an alertMessage and display it as a Bootstrap alert -->
    <% if (typeof alertMessage !== 'undefined') { %>
        <div class="alert alert-warning" role="alert">
            <%= alertMessage %>
        </div>
    <% } %>

    <!-- If there are items in the cart -->
    <% if (cart.items && cart.items.length > 0) { %>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Image</th> <!-- New column for product image -->
                    <th>Product</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            <% cart.items.forEach(item => { %>
                <tr>
                    <td>
                        <!-- Display the product image, using the first image from the imgArray or default -->
                        <img src="<%= item.productImage %>" alt="Product Image" style="width: 100px;" />
                    </td>
                    <td><%= item.productId.name %></td> <!-- Product name -->
                    <td>$<%= item.productPrice %></td> <!-- Product price -->
                    <td>
                        <!-- Form to update quantity -->
                        <form action="/cart/update/<%= item.productId._id %>" method="POST" style="display: inline;">
                          <!-- Ensure that the quantity cannot exceed stock -->
                          <input type="number" name="productCount" value="<%= item.productCount %>" min="1" max="<%= item.productId.stock %>" style="width: 50px;">
                          <button type="submit" class="btn btn-primary btn-sm">Update</button>
                        </form>
                        <!-- Display stock message if quantity exceeds stock -->
                        <% if (item.productCount >= item.productId.stock) { %>
                            <p class="text-danger">Only <%= item.productId.stock %> left in stock</p>
                        <% } %>
                    </td>
                    <td>$<%= item.productPrice * item.productCount %></td> <!-- Total for this product -->
                    <td>
                        <!-- Button to remove item from cart -->
                        <a href="/cart/remove/<%=item.productId._id %>" class="btn btn-danger">Remove</a>
                    </td>
                </tr>
            <% }); %>
            </tbody>
        </table>

        <!-- Calculate and display the total cart price -->
        <h4>Total Amount: $<%= cart.items.reduce((total, item) => total + (item.productPrice * item.productCount), 0) %></h4>

        <!-- Button to proceed to checkout -->
        <a href="/checkout" class="btn btn-success">Proceed to Checkout</a>

    <% } else { %>
        <!-- Message when cart is empty -->
        <p>Your cart is empty.</p>
    <% } %>
</div>



  <%-include('footer') %>
