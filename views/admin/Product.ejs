<!-- Sidebar Start -->
<div class="container-fluid pt-4 px-4">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3">
        <div class="sidebar pe-4 pb-3 bg-light">
          <nav class="navbar navbar-light">
            <a href="index.html" class="navbar-brand mx-4 mb-3">
              <h3 class="text-primary">
                <i class="fa fa-hashtag me-2"></i>Dashboard
              </h3>
            </a>
            <div class="d-flex align-items-center ms-4 mb-4">
              <div class="position-relative">
                <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
              </div>
              <div class="ms-3">
                <h6 class="mb-0">DEEPIKA PS</h6>
                <span>Admin</span>
              </div>
            </div>
            <div class="navbar-nav w-100">
              <a href="index.html" class="nav-item nav-link active">
                <i class="fa fa-tachometer-alt me-2"></i>Dashboard
              </a>
              <div class="nav-item">
                <a href="#" class="nav-link dropdown-toggle">
                  <i class="fa fa-laptop me-2"></i>Sales Report
                </a>
              </div>
  
              <!-- Category Section with Toggle -->
              <div class="nav-item">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#CategoryMenu" id="categoryMenuLink">
                  <i class="fa fa-keyboard me-2"></i>Category
                </a>
                <div id="CategoryMenu" class="collapse">
                  <ul class="navbar-nav ps-3">
                    <li class="nav-item">
                      <a href="/admin/addCategory" class="nav-link">
                        <i class="fa fa-plus me-2"></i>Add Category
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="/admin/editCategory" class="nav-link">
                        <i class="fa fa-list me-2"></i>Category List
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="nav-item">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#productMenu" id="productMenuLink">
                    <i class="fa fa-keyboard me-2"></i>Products
                </a>
                <div id="productMenu" class="collapse">
                    <ul class="navbar-nav ps-3">
                        <li class="nav-item">
                            <a href="/admin/addProduct" class="nav-link">
                                <i class="fa fa-plus me-2"></i>Add Product
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/editProduct" class="nav-link">
                                <i class="fa fa-list me-2"></i>Product List
                            </a>
                        </li>
                    </ul>
                </div>
                </div>
  
              <a href="/admin/users" class="nav-item nav-link">
                <i class="fa fa-table me-2"></i>Customers
              </a>
              <a href="chart.html" class="nav-item nav-link">
                <i class="fa fa-chart-bar me-2"></i>Coupons
              </a>
              <a href="chart.html" class="nav-item nav-link">
                <i class="fa fa-chart-bar me-2"></i>Offers
              </a>
              <a href="chart.html" class="nav-item nav-link">
                <i class="fa fa-chart-bar me-2"></i>Popups
              </a>
              <a href="logout" class="nav-item nav-link">
                <i class="fa fa-sign-out-alt me-2"></i>Logout
              </a>
            </div>
          </nav>
        </div>
      </div>


      <!-- Content Start -->
<div class="content">
  
    <!-- Navbar Start -->
    <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
        <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
            <h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
        </a>
        <a href="#" class="sidebar-toggler flex-shrink-0">
            <i class="fa fa-bars"></i>
        </a>
        
        <div class="navbar-nav align-items-center ms-auto">
           
        
        
            <div class="nav-item dropdown">
                <a href="#" class="nav-link">
                
                    <span class="d-none d-lg-inline-flex">Deepika </span>
                </a>
                <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                    <a href="#" class="dropdown-item">My Profile</a>
                    <!-- <a href="#" class="dropdown-item">Settings</a> -->
                    <a href="#" class="dropdown-item">Log Out</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Navbar End -->

<!-- Form Start -->
<div class="container mt-5">
    <h2>Add New Product</h2>

    <form id="productForm" action="/admin/addProduct" method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="name">Product Name</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <div class="form-group">
            <label for="price">Price</label>
            <input type="number" class="form-control" id="price" name="price" required>
        </div>
        <div class="form-group">
            <label for="stock">Stock</label>
            <input type="number" class="form-control" id="stock" name="stock" required>
        </div>
        <div class="form-group">
            <label for="category">Category</label>
            <select class="form-control" id="category" name="category" required>
                <% categories.forEach(function(category) { %>
                    <option value="<%= category.name %>"><%= category.name %></option>
                <% }); %>
            </select>
        </div>
        <div class="form-group">
            <label for="description">Product Description</label>
            <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
        </div>
        <div class="mb-4">  
            <label for="images" class="block text-sm font-medium text-gray-700">Product Images</label>
            <input type="file" name="productImages" id="productImages" class="mt-1 p-2 border border-gray-300 rounded w-full " >
            <label class="productImgErr text-red-500"></label>
          </div> 
  
        <!-- cropping container -->
        <div id="cropperContainer" style="display: none; max-width: 500px; margin-bottom: 20px;"> 
          <img id="image" src="" alt="Image for cropping" style="max-width: 100%;">  
        </div>

        <!-- Cropped images preview container -->
        <div id="croppedImagesContainer" class="mb-4">
          <h3 class="text-sm font-medium text-gray-700">Cropped Images</h3>
          <div id="croppedImages" class="flex flex-wrap">  
            <!-- Cropped images will be appended here dynamically -->
          </div>
        </div>
  
        <button type="button" id="cropButton" class="btn btn-primary mt-3">Crop & Upload</button>
        <button type="submit" class="btn btn-primary mt-3">Add Product</button>
    </form>
</div>




<!-- Include jQuery, Bootstrap JS, Cropper.js, and SweetAlert -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

<script>
    let cropper;
    const inputImage = document.getElementById('productImages');
    const image = document.getElementById('image');
    const cropButton = document.getElementById('cropButton');
    const cropperContainer = document.getElementById('cropperContainer');
    const croppedImagesContainer = document.getElementById('croppedImages');
    let croppedImagesData = [];

    // Handle image input and initialize cropper
    inputImage.addEventListener('change', (event) => {
        const files = event.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                image.src = e.target.result;
                cropperContainer.style.display = 'block';
                cropButton.style.display = 'inline-block';
                if (cropper) {
                    cropper.destroy();
                }
                cropper = new Cropper(image, {
                    aspectRatio: NaN,
                    viewMode: 1,
                    dragMode: 'move',
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                    minCropBoxWidth: 50,
                    minCropBoxHeight: 50,
                });
            };
            reader.readAsDataURL(file);
        }
    });

    // Handle cropping and display cropped images with a close button
    cropButton.addEventListener('click', () => {
        if (!cropper) {
            alert('Please select an image first.');
            return;
        }

        cropper.getCroppedCanvas().toBlob((blob) => {
            croppedImagesData.push(blob);

            const url = URL.createObjectURL(blob);
            const imageWrapper = document.createElement('div');
            imageWrapper.style.position = 'relative';
            imageWrapper.style.margin = '10px';
            imageWrapper.style.display = 'inline-block';

            // Add close button
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '&times;';
            closeButton.style.position = 'absolute';
            closeButton.style.top = '5px';
            closeButton.style.right = '5px';
            closeButton.style.backgroundColor = '#ff0000';
            closeButton.style.color = '#fff';
            closeButton.style.border = 'none';
            closeButton.style.borderRadius = '50%';
            closeButton.style.width = '20px';
            closeButton.style.height = '20px';
            closeButton.style.cursor = 'pointer';

            closeButton.addEventListener('click', function() {
                const index = Array.from(croppedImagesContainer.children).indexOf(imageWrapper);
                croppedImagesData.splice(index, 1); // Remove the cropped image from the data array
                croppedImagesContainer.removeChild(imageWrapper); // Remove the image element
            });

            const imgElement = document.createElement('img');
            imgElement.src = url;
            imgElement.style.maxWidth = '100px';
            imgElement.style.margin = '10px';

            imageWrapper.appendChild(closeButton);
            imageWrapper.appendChild(imgElement);
            croppedImagesContainer.appendChild(imageWrapper);

            cropperContainer.style.display = 'none';
            cropButton.style.display = 'none';
            inputImage.value = '';
            inputImage.disabled = false;
        }, 'image/png');
    });

    // Handle form submission with cropped images
    document.getElementById('productForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(this);
        formData.delete('productImages'); // Remove the original productImages file input

        // Append all cropped images as blobs to the form data
        croppedImagesData.forEach((blob, index) => {
            formData.append(`productImages`, blob, `cropped_${index}.png`);
        });

        fetch(this.action, {
            method: 'POST',
            body: formData,
        }).then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        }).then(data => {
            if (data.message) {
                alert(data.message);
                location.reload();
            } else {
                alert('Failed to add product: ' + (data.error || 'Unknown error'));
            }
        }).catch(error => {
            console.error('Error:', error);
            alert('Failed to add product: ' + error.message);
        });
    });
</script>



  
 
  